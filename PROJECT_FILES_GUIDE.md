# Trading Custody System - é¡¹ç›®æ–‡ä»¶å®Œæ•´è¯´æ˜æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
> **æ›´æ–°æ—¶é—´**: 2024-12-23  
> **é¡¹ç›®ç®€ä»‹**: åŸºäº React + Express çš„äº¤æ˜“ä¸æ‰˜ç®¡ç®¡ç†ç³»ç»Ÿ

---

## ğŸ“‹ ç›®å½•

- [1. é¡¹ç›®æ¦‚è§ˆ](#1-é¡¹ç›®æ¦‚è§ˆ)
- [2. æŠ€æœ¯æ¶æ„](#2-æŠ€æœ¯æ¶æ„)
- [3. ç›®å½•ç»“æ„](#3-ç›®å½•ç»“æ„)
- [4. æ ¹ç›®å½•æ–‡ä»¶](#4-æ ¹ç›®å½•æ–‡ä»¶)
- [5. å‰ç«¯æºç  (src/)](#5-å‰ç«¯æºç -src)
- [6. åç«¯æºç  (server/)](#6-åç«¯æºç -server)
- [7. æµ‹è¯•æ–‡ä»¶ (tests/)](#7-æµ‹è¯•æ–‡ä»¶-tests)
- [8. æ–‡æ¡£ç›®å½• (docs/)](#8-æ–‡æ¡£ç›®å½•-docs)
- [9. é…ç½®æ–‡ä»¶è¯¦è§£](#9-é…ç½®æ–‡ä»¶è¯¦è§£)
- [10. æ•°æ®åº“è®¾è®¡](#10-æ•°æ®åº“è®¾è®¡)
- [11. éƒ¨ç½²ç›¸å…³](#11-éƒ¨ç½²ç›¸å…³)

---

## 1. é¡¹ç›®æ¦‚è§ˆ

### 1.1 é¡¹ç›®å®šä½
Trading Custody System æ˜¯ä¸€ä¸ªä¸ºä¸ªäººæŠ•èµ„è€…è®¾è®¡çš„èµ„é‡‘å’ŒæŒä»“ç®¡ç†ç³»ç»Ÿï¼Œæä¾›ï¼š
- ç”¨æˆ·èº«ä»½éªŒè¯å’Œæƒé™ç®¡ç†ï¼ˆåŸºäº JWTï¼‰
- èµ„é‡‘æµæ°´è®°å½•å’Œä½™é¢ç®¡ç†
- è‚¡ç¥¨ã€æœŸè´§ã€åŸºé‡‘ç­‰æŒä»“ç®¡ç†
- ç®¡ç†å‘˜åå°ç»Ÿä¸€ç®¡æ§
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯

### 1.2 æ ¸å¿ƒç‰¹æ€§
- **å‰åç«¯åˆ†ç¦»**: React 18 + Express.js
- **æ•°æ®æŒä¹…åŒ–**: SQLite æ•°æ®åº“
- **å®‰å…¨è®¤è¯**: JWT Token + bcrypt å¯†ç åŠ å¯†
- **å®æ—¶ä»·æ ¼åŒæ­¥**: å®šæ—¶ä»»åŠ¡è‡ªåŠ¨åŒæ­¥å¸‚åœºä»·æ ¼
- **å®Œæ•´æµ‹è¯•**: å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + E2E æµ‹è¯•
- **å®¹å™¨åŒ–éƒ¨ç½²**: Docker + Docker Compose

---

## 2. æŠ€æœ¯æ¶æ„

### 2.1 æŠ€æœ¯æ ˆ

#### å‰ç«¯æŠ€æœ¯æ ˆ
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| React | 18.2.0 | UI æ¡†æ¶ |
| React Router | 6.14.0 | è·¯ç”±ç®¡ç† |
| Ant Design Mobile | 5.39.0 | ç§»åŠ¨ç«¯ UI ç»„ä»¶åº“ |
| Create React App | 5.0.1 | é¡¹ç›®è„šæ‰‹æ¶ |

#### åç«¯æŠ€æœ¯æ ˆ
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Express.js | 4.18.2 | Web æ¡†æ¶ |
| SQLite3 | 5.1.7 | æ•°æ®åº“ |
| JWT | 8.5.1 | èº«ä»½è®¤è¯ |
| bcrypt | 6.0.0 | å¯†ç åŠ å¯† |
| Winston | 3.17.0 | æ—¥å¿—ç®¡ç† |
| node-schedule | 2.1.0 | å®šæ—¶ä»»åŠ¡ |

#### å¼€å‘å·¥å…·
| å·¥å…· | ç”¨é€” |
|------|------|
| Jest | å•å…ƒæµ‹è¯•æ¡†æ¶ |
| Cypress | E2E æµ‹è¯•å·¥å…· |
| ESLint | ä»£ç æ£€æŸ¥ |
| Prettier | ä»£ç æ ¼å¼åŒ– |
| Husky | Git Hooks |
| Nodemon | å¼€å‘çƒ­é‡è½½ |

### 2.2 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æµè§ˆå™¨å®¢æˆ·ç«¯                          â”‚
â”‚                   (React 18 + Ant Design)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP/HTTPS
                     â”‚ (JWT Token)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Nginx åå‘ä»£ç†                          â”‚
â”‚                  (ç”Ÿäº§ç¯å¢ƒ / Docker)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é™æ€èµ„æºæœåŠ¡   â”‚      â”‚   Express API    â”‚
â”‚  (React Build) â”‚      â”‚   (Node.js)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚            â”‚            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
            â”‚ ä¸­é—´ä»¶å±‚  â”‚  â”‚ ä¸šåŠ¡é€»è¾‘  â”‚  â”‚ å·¥å…·å±‚  â”‚
            â”‚ (Auth/   â”‚  â”‚ (Service) â”‚  â”‚ (Utils) â”‚
            â”‚  Log)    â”‚  â”‚           â”‚  â”‚         â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                         â”‚   DAO å±‚     â”‚
                         â”‚  (æ•°æ®è®¿é—®)   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                         â”‚   SQLite    â”‚
                         â”‚   æ•°æ®åº“     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ç›®å½•ç»“æ„

```
trading-custody/
â”œâ”€â”€ .github/                    # GitHub é…ç½®
â”‚   â”œâ”€â”€ workflows/              # CI/CD å·¥ä½œæµ
â”‚   â””â”€â”€ ISSUE_TEMPLATE/         # Issue æ¨¡æ¿
â”œâ”€â”€ .husky/                     # Git Hooks é…ç½®
â”œâ”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ public/                     # é™æ€èµ„æº
â”œâ”€â”€ scripts/                    # è„šæœ¬å·¥å…·
â”œâ”€â”€ server/                     # åç«¯æºç  â­
â”‚   â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ constants/              # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ controllers/            # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ dao/                    # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ data/                   # æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ middleware/             # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ migrations/             # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ services/               # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ tests/                  # åç«¯æµ‹è¯•
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ validators/             # æ•°æ®éªŒè¯
â”œâ”€â”€ src/                        # å‰ç«¯æºç  â­
â”‚   â”œâ”€â”€ api/                    # API è°ƒç”¨å°è£…
â”‚   â”œâ”€â”€ components/             # React ç»„ä»¶
â”‚   â”œâ”€â”€ config/                 # å‰ç«¯é…ç½®
â”‚   â”œâ”€â”€ constants/              # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ contexts/               # React Context
â”‚   â”œâ”€â”€ hooks/                  # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ layouts/                # é¡µé¢å¸ƒå±€
â”‚   â”œâ”€â”€ routes/                 # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ styles/                 # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”œâ”€â”€ tests/                      # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ cypress/                # E2E æµ‹è¯•
â”‚   â””â”€â”€ unit/                   # å•å…ƒæµ‹è¯•
â””â”€â”€ [é…ç½®æ–‡ä»¶]                   # å„ç±»é…ç½®æ–‡ä»¶
```

---

## 4. æ ¹ç›®å½•æ–‡ä»¶

### 4.1 é…ç½®æ–‡ä»¶

| æ–‡ä»¶å | ä½œç”¨ | é‡è¦æ€§ |
|--------|------|--------|
| **package.json** | é¡¹ç›®é…ç½®å’Œä¾èµ–ç®¡ç†ï¼Œå®šä¹‰æ‰€æœ‰ npm è„šæœ¬ | â­â­â­â­â­ |
| **.env.development** | å¼€å‘ç¯å¢ƒå˜é‡é…ç½®ï¼ˆç«¯å£ã€APIåœ°å€ç­‰ï¼‰ | â­â­â­â­â­ |
| **.env.production** | ç”Ÿäº§ç¯å¢ƒå˜é‡é…ç½® | â­â­â­â­â­ |
| **.env.example** | ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿ | â­â­â­â­ |
| **babel.config.js** | Babel è½¬è¯‘é…ç½® | â­â­â­ |
| **jest.config.js** | Jest æµ‹è¯•æ¡†æ¶é…ç½® | â­â­â­ |
| **.eslintrc.js** | ESLint ä»£ç æ£€æŸ¥è§„åˆ™ | â­â­â­ |
| **.prettierrc** | Prettier ä»£ç æ ¼å¼åŒ–è§„åˆ™ | â­â­â­ |
| **.editorconfig** | ç¼–è¾‘å™¨ç»Ÿä¸€é…ç½® | â­â­ |

### 4.2 Docker ç›¸å…³

| æ–‡ä»¶å | ä½œç”¨ | è¯´æ˜ |
|--------|------|------|
| **Dockerfile.backend** | åç«¯ Docker é•œåƒæ„å»ºæ–‡ä»¶ | åŸºäº Node.js 16 Alpine |
| **Dockerfile.frontend** | å‰ç«¯ Docker é•œåƒæ„å»ºæ–‡ä»¶ | å¤šé˜¶æ®µæ„å»ºï¼ŒNginx æä¾›æœåŠ¡ |
| **docker-compose.yml** | Docker Compose ç¼–æ’é…ç½® | å®šä¹‰å‰åç«¯æœåŠ¡ã€ç½‘ç»œã€æ•°æ®å· |
| **docker-compose.simple.yml** | ç®€åŒ–ç‰ˆ Docker Compose | å¿«é€Ÿéƒ¨ç½²ç‰ˆæœ¬ |
| **.dockerignore** | Docker æ„å»ºå¿½ç•¥æ–‡ä»¶ | æ’é™¤ node_modulesã€æµ‹è¯•æ–‡ä»¶ç­‰ |
| **nginx.conf** | Nginx é…ç½®æ–‡ä»¶ | åå‘ä»£ç†å’Œé™æ€èµ„æºæœåŠ¡ |

### 4.3 éƒ¨ç½²è„šæœ¬

| æ–‡ä»¶å | ä½œç”¨ |
|--------|------|
| **deploy.sh** | é€šç”¨éƒ¨ç½²è„šæœ¬ |
| **docker-deploy.sh** | Docker éƒ¨ç½²è„šæœ¬ |
| **docker-publish.sh** | Docker é•œåƒå‘å¸ƒè„šæœ¬ |
| **docker-data-manager.sh** | Docker æ•°æ®ç®¡ç†è„šæœ¬ |

### 4.4 æ–‡æ¡£æ–‡ä»¶

| æ–‡ä»¶å | ä½œç”¨ |
|--------|------|
| **README.md** | é¡¹ç›®ä¸»æ–‡æ¡£ï¼ŒåŒ…å«å¿«é€Ÿå¼€å§‹æŒ‡å— |
| **CHANGELOG.md** | ç‰ˆæœ¬å˜æ›´æ—¥å¿— |
| **CONTRIBUTING.md** | è´¡çŒ®æŒ‡å— |
| **CODE_OF_CONDUCT.md** | è¡Œä¸ºå‡†åˆ™ |
| **LICENSE** | MIT å¼€æºè®¸å¯è¯ |
| **DEPLOY_SIMPLE.md** | ç®€åŒ–éƒ¨ç½²æ–‡æ¡£ |

### 4.5 Git é…ç½®

| æ–‡ä»¶å | ä½œç”¨ |
|--------|------|
| **.gitignore** | Git ç‰ˆæœ¬æ§åˆ¶å¿½ç•¥æ–‡ä»¶åˆ—è¡¨ |
| **.husky/pre-commit** | Git æäº¤å‰é’©å­ï¼ˆè¿è¡Œ lint-stagedï¼‰ |

---

## 5. å‰ç«¯æºç  (src/)

### 5.1 ç»„ä»¶ç›®å½• (components/)

#### æ ¸å¿ƒé¡µé¢ç»„ä»¶

| æ–‡ä»¶å | åŠŸèƒ½æè¿° | è·¯ç”± | æƒé™è¦æ±‚ |
|--------|---------|------|---------|
| **Login.jsx** | ç”¨æˆ·ç™»å½•é¡µé¢ | `/login` | æ—  |
| **AdminDashboard.jsx** | ç®¡ç†å‘˜ä»ªè¡¨ç›˜ | `/` | ç®¡ç†å‘˜ |
| **UserFundPosition.jsx** | ç”¨æˆ·èµ„é‡‘æŒä»“å±•ç¤º | `/user-fund-position` | å·²ç™»å½• |
| **UserManagement.jsx** | ç”¨æˆ·ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ | `/user-management` | ç®¡ç†å‘˜ |
| **FundManagement.jsx** | èµ„é‡‘ç®¡ç†ï¼ˆæµæ°´ã€ä½™é¢ï¼‰ | `/fund-management` | ç®¡ç†å‘˜ |
| **PositionManagement.jsx** | æŒä»“ç®¡ç†ï¼ˆä¹°å–è®°å½•ï¼‰ | `/position-management` | ç®¡ç†å‘˜ |
| **ChangePassword.jsx** | ä¿®æ”¹å¯†ç  | `/change-password` | å·²ç™»å½• |

#### å…¬å…±ç»„ä»¶

| æ–‡ä»¶å | åŠŸèƒ½æè¿° |
|--------|---------|
| **NavBar.jsx** | å¯¼èˆªæ ç»„ä»¶ |
| **UserSelect.jsx** | ç”¨æˆ·é€‰æ‹©ä¸‹æ‹‰ç»„ä»¶ |

#### æ ·å¼æ–‡ä»¶
æ¯ä¸ªç»„ä»¶éƒ½æœ‰å¯¹åº”çš„ `.css` æ–‡ä»¶ï¼Œå¦‚ `Login.css`ã€`AdminDashboard.css` ç­‰ã€‚

### 5.2 API ç›®å½• (api/)

| æ–‡ä»¶å | åŠŸèƒ½ | ä¸»è¦æ–¹æ³• |
|--------|------|---------|
| **apiClient.js** | API å®¢æˆ·ç«¯åŸºç¡€å°è£… | `get()`, `post()`, `put()`, `delete()` |
| **userApi.js** | ç”¨æˆ·ç›¸å…³ API | `login()`, `getCurrentUser()`, `getAllUsers()`, `createUser()`, `updateUser()`, `deleteUser()` |
| **fundApi.js** | èµ„é‡‘ç›¸å…³ API | `getFundBalance()`, `getFundLogs()`, `addFund()`, `withdrawFund()` |
| **positionApi.js** | æŒä»“ç›¸å…³ API | `getPositions()`, `addPosition()`, `deletePositions()`, `calculateProfit()` |

**æµ‹è¯•æ–‡ä»¶**: æ¯ä¸ª API æ–‡ä»¶éƒ½æœ‰å¯¹åº”çš„ `.test.js` æµ‹è¯•æ–‡ä»¶ã€‚

### 5.3 Hooks ç›®å½• (hooks/)

| æ–‡ä»¶å | åŠŸèƒ½ | ä¸»è¦æ–¹æ³• |
|--------|------|---------|
| **useFund.js** | èµ„é‡‘ç®¡ç† Hook | `fetchBalance()`, `fetchLogs()`, `handleOperation()` |
| **usePosition.js** | æŒä»“ç®¡ç† Hook | `fetchPositions()`, `addPosition()`, `deletePositions()` |
| **useUser.js** | ç”¨æˆ·ç®¡ç† Hook | `fetchUsers()`, `createUser()`, `updateUser()`, `deleteUser()` |

**æµ‹è¯•æ–‡ä»¶**: æ¯ä¸ª Hook éƒ½æœ‰å¯¹åº”çš„ `.test.js` æµ‹è¯•æ–‡ä»¶ã€‚

### 5.4 Context ç›®å½• (contexts/)

| æ–‡ä»¶å | åŠŸèƒ½ | æä¾›çš„å€¼ |
|--------|------|---------|
| **AuthContext.jsx** | å…¨å±€è®¤è¯çŠ¶æ€ç®¡ç† | `user`, `loading`, `login()`, `logout()`, `checkAuth()` |

### 5.5 è·¯ç”±ç›®å½• (routes/)

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **index.jsx** | è·¯ç”±é…ç½®ï¼Œå®šä¹‰æ‰€æœ‰é¡µé¢è·¯ç”±å’Œæƒé™è¦æ±‚ |
| **ProtectedRoute.jsx** | è·¯ç”±å®ˆå«ç»„ä»¶ï¼Œå¤„ç†è®¤è¯å’Œæƒé™æ£€æŸ¥ |

### 5.6 æ ·å¼ç›®å½• (styles/)

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **global.css** | å…¨å±€æ ·å¼å®šä¹‰ |
| **variables.css** | CSS å˜é‡ï¼ˆé¢œè‰²ã€å­—ä½“ã€é—´è·ç­‰ï¼‰ |
| **components.css** | é€šç”¨ç»„ä»¶æ ·å¼ |
| **forms.css** | è¡¨å•æ ·å¼ |

### 5.7 å·¥å…·ç›®å½• (utils/)

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **formatUtils.js** | æ ¼å¼åŒ–å·¥å…·ï¼ˆæ—¥æœŸã€é‡‘é¢ã€ç™¾åˆ†æ¯”ç­‰ï¼‰ |
| **errorHandler.js** | é”™è¯¯å¤„ç†å·¥å…· |

### 5.8 å…¶ä»–æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **App.jsx** | åº”ç”¨æ ¹ç»„ä»¶ï¼Œé…ç½®è·¯ç”±å’Œå…¨å±€ Provider |
| **App.css** | åº”ç”¨æ ¹æ ·å¼ |
| **index.js** | åº”ç”¨å…¥å£æ–‡ä»¶ï¼Œæ¸²æŸ“ React åº”ç”¨ |
| **setupTests.js** | æµ‹è¯•ç¯å¢ƒé…ç½® |

---

## 6. åç«¯æºç  (server/)

### 6.1 æ¶æ„åˆ†å±‚

```
è¯·æ±‚æµç¨‹ï¼š
Client â†’ Routes â†’ Middleware â†’ Controller â†’ Service â†’ DAO â†’ Database
                     â†“
                  Validator
```

### 6.2 é…ç½®ç›®å½• (config/)

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **config.js** | ä¸»é…ç½®æ–‡ä»¶ï¼Œæ•´åˆæ‰€æœ‰é…ç½® |
| **env.js** | ç¯å¢ƒå˜é‡è§£æå’ŒéªŒè¯ |
| **routes.js** | è·¯ç”±é…ç½®ï¼Œå®šä¹‰æ‰€æœ‰ API ç«¯ç‚¹ |

### 6.3 å¸¸é‡ç›®å½• (constants/)

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **index.js** | å®šä¹‰ç³»ç»Ÿå¸¸é‡ï¼ˆé”™è¯¯æ¶ˆæ¯ã€é™æµé…ç½®ã€èµ„äº§ç±»å‹ç­‰ï¼‰ |

### 6.4 æ§åˆ¶å™¨ç›®å½• (controllers/)

| æ–‡ä»¶å | åŠŸèƒ½ | ä¸»è¦æ–¹æ³• |
|--------|------|---------|
| **authController.js** | è®¤è¯æ§åˆ¶å™¨ | `login()`, `refresh()`, `logout()`, `me()` |
| **userController.js** | ç”¨æˆ·æ§åˆ¶å™¨ | `getAllUsers()`, `getCurrentUser()`, `createUser()`, `updateUser()`, `deleteUser()`, `updatePassword()` |
| **fundController.js** | èµ„é‡‘æ§åˆ¶å™¨ | `getFundBalance()`, `getFundLogs()`, `handleFundOperation()` |
| **positionController.js** | æŒä»“æ§åˆ¶å™¨ | `getPositions()`, `addPosition()`, `deletePositions()`, `calculatePositionProfit()` |

### 6.5 æœåŠ¡ç›®å½• (services/)

| æ–‡ä»¶å | åŠŸèƒ½ | èŒè´£ |
|--------|------|------|
| **authService.js** | è®¤è¯æœåŠ¡ | JWT Token ç”Ÿæˆã€éªŒè¯ã€åˆ·æ–° |
| **userService.js** | ç”¨æˆ·æœåŠ¡ | ç”¨æˆ·ä¸šåŠ¡é€»è¾‘ã€å¯†ç åŠ å¯† |
| **fundService.js** | èµ„é‡‘æœåŠ¡ | èµ„é‡‘æ“ä½œã€ä½™é¢è®¡ç®—ã€æµæ°´è®°å½• |
| **positionService.js** | æŒä»“æœåŠ¡ | æŒä»“æ“ä½œã€ç›ˆäºè®¡ç®— |
| **priceService.js** | ä»·æ ¼æœåŠ¡ | ä»·æ ¼æ•°æ®åŒæ­¥ã€å¤–éƒ¨ API è°ƒç”¨ |

### 6.6 DAO ç›®å½• (dao/)

æ•°æ®è®¿é—®å±‚ï¼Œå°è£…æ•°æ®åº“æ“ä½œã€‚

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **userDao.js** | ç”¨æˆ·æ•°æ®è®¿é—® |
| **fundDao.js** | èµ„é‡‘æ•°æ®è®¿é—® |
| **positionDao.js** | æŒä»“æ•°æ®è®¿é—® |
| **priceDao.js** | ä»·æ ¼æ•°æ®è®¿é—® |

### 6.7 ä¸­é—´ä»¶ç›®å½• (middleware/)

| æ–‡ä»¶å | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| **authMiddleware.js** | è®¤è¯ä¸­é—´ä»¶ | `authenticateToken()`, `adminOnly()`, `checkResourceOwnership()` |
| **errorMiddleware.js** | é”™è¯¯å¤„ç†ä¸­é—´ä»¶ | ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼ |
| **logMiddleware.js** | æ—¥å¿—ä¸­é—´ä»¶ | è®°å½•æ‰€æœ‰ HTTP è¯·æ±‚ |
| **validationMiddleware.js** | éªŒè¯ä¸­é—´ä»¶ | å¤„ç† express-validator éªŒè¯ç»“æœ |

### 6.8 éªŒè¯å™¨ç›®å½• (validators/)

ä½¿ç”¨ express-validator è¿›è¡Œè¯·æ±‚å‚æ•°éªŒè¯ã€‚

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **authValidator.js** | è®¤è¯ç›¸å…³éªŒè¯è§„åˆ™ |
| **userValidator.js** | ç”¨æˆ·ç›¸å…³éªŒè¯è§„åˆ™ |
| **fundValidator.js** | èµ„é‡‘ç›¸å…³éªŒè¯è§„åˆ™ |

### 6.9 å·¥å…·ç›®å½• (utils/)

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **database.js** | æ•°æ®åº“è¿æ¥å’Œåˆå§‹åŒ– |
| **logger.js** | Winston æ—¥å¿—å·¥å…· |
| **jwtHelper.js** | JWT Token å·¥å…· |
| **passwordHelper.js** | å¯†ç åŠ å¯†å·¥å…· |
| **priceUtils.js** | ä»·æ ¼è®¡ç®—å·¥å…· |
| **AppError.js** | è‡ªå®šä¹‰é”™è¯¯ç±» |
| **errorCodes.js** | é”™è¯¯ç å®šä¹‰ |

### 6.10 æ•°æ®åº“è¿ç§» (migrations/)

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **000_init_database.sql** | æ•°æ®åº“åˆå§‹åŒ– SQL è„šæœ¬ |
| **migrator.js** | æ•°æ®åº“è¿ç§»å·¥å…· |
| **reset_admin_password.js** | é‡ç½®ç®¡ç†å‘˜å¯†ç è„šæœ¬ |
| **README.md** | è¿ç§»è¯´æ˜æ–‡æ¡£ |

### 6.11 æ•°æ®ç›®å½• (data/)

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **further_daily.json** | æœŸè´§æ—¥çº¿æ•°æ®ç¤ºä¾‹ |
| **database.db** | SQLite æ•°æ®åº“æ–‡ä»¶ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰ |

### 6.12 æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **server.js** | æœåŠ¡å™¨å…¥å£æ–‡ä»¶ï¼Œå¯åŠ¨ Express åº”ç”¨å’Œå®šæ—¶ä»»åŠ¡ |

---

## 7. æµ‹è¯•æ–‡ä»¶ (tests/)

### 7.1 å•å…ƒæµ‹è¯• (unit/)

| æ–‡ä»¶å | æµ‹è¯•å¯¹è±¡ |
|--------|---------|
| **useFund.test.js** | èµ„é‡‘ç®¡ç† Hook |
| **usePosition.test.js** | æŒä»“ç®¡ç† Hook |
| **useUser.test.js** | ç”¨æˆ·ç®¡ç† Hook |

### 7.2 E2E æµ‹è¯• (cypress/)

| ç›®å½•/æ–‡ä»¶ | åŠŸèƒ½ |
|----------|------|
| **cypress.config.js** | Cypress é…ç½®æ–‡ä»¶ |
| **e2e/** | ç«¯åˆ°ç«¯æµ‹è¯•ç”¨ä¾‹ç›®å½• |
| **support/** | æµ‹è¯•æ”¯æŒæ–‡ä»¶ï¼ˆè‡ªå®šä¹‰å‘½ä»¤ç­‰ï¼‰ |
| **screenshots/** | æµ‹è¯•å¤±è´¥æˆªå›¾ |
| **videos/** | æµ‹è¯•å½•åƒ |

### 7.3 åç«¯æµ‹è¯• (server/tests/)

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| **jest.config.js** | Jest é…ç½® |
| **setupTests.js** | æµ‹è¯•ç¯å¢ƒè®¾ç½® |

---

## 8. æ–‡æ¡£ç›®å½• (docs/)

| æ–‡ä»¶å | å†…å®¹ |
|--------|------|
| **api.md** | API æ¥å£æ–‡æ¡£ |
| **components.md** | ç»„ä»¶è¯´æ˜æ–‡æ¡£ |
| **deployment.md** | éƒ¨ç½²æ–‡æ¡£ |
| **DOCKER_DEPLOYMENT.md** | Docker éƒ¨ç½²è¯¦ç»†æŒ‡å— |
| **ENVIRONMENT_VARIABLES.md** | ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜ |
| **CODING_STANDARDS.md** | ç¼–ç è§„èŒƒ |
| **é¡¹ç›®æ–‡ä»¶è¯´æ˜.md** | é¡¹ç›®æ–‡ä»¶è¯´æ˜ï¼ˆæ—§ç‰ˆï¼‰ |

---

## 9. é…ç½®æ–‡ä»¶è¯¦è§£

### 9.1 ç¯å¢ƒå˜é‡é…ç½®

#### å¼€å‘ç¯å¢ƒ (.env.development)
```bash
NODE_ENV=development
PORT=3000                    # å‰ç«¯ç«¯å£
SERVER_PORT=3001             # åç«¯ç«¯å£
REACT_APP_API_BASE_URL=      # API åŸºç¡€ URLï¼ˆä½¿ç”¨ proxyï¼‰
BROWSER=none                 # ç¦æ­¢è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
```

#### ç”Ÿäº§ç¯å¢ƒ (.env.production)
```bash
NODE_ENV=production
REACT_APP_API_BASE_URL=http://your-domain.com
```

#### åç«¯ç¯å¢ƒå˜é‡
```bash
# æ•°æ®åº“
DATABASE_PATH=./server/data/database.db

# JWT é…ç½®
JWT_ACCESS_SECRET=your-secret-key
JWT_REFRESH_SECRET=your-refresh-secret-key
JWT_ACCESS_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d

# CORS
CORS_ORIGIN=http://localhost:3000

# å¤–éƒ¨ API
STOCK_API_URL=http://api.example.com/stock
FUTURE_API_URL=http://api.example.com/future

# å®šæ—¶ä»»åŠ¡
PRICE_SYNC_CRON=0 17 * * *  # æ¯å¤© 17:00 åŒæ­¥ä»·æ ¼

# æ—¥å¿—
LOG_LEVEL=info
LOG_FILE_PATH=./logs/app.log
```

### 9.2 NPM è„šæœ¬è¯´æ˜

#### å¼€å‘è„šæœ¬
```bash
npm run dev              # åŒæ—¶å¯åŠ¨å‰åç«¯å¼€å‘æœåŠ¡å™¨
npm run client           # ä»…å¯åŠ¨å‰ç«¯
npm run server           # ä»…å¯åŠ¨åç«¯
```

#### æ„å»ºè„šæœ¬
```bash
npm run build            # æ„å»ºå‰ç«¯ç”Ÿäº§ç‰ˆæœ¬
npm start                # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
```

#### æµ‹è¯•è„šæœ¬
```bash
npm test                 # è¿è¡Œå‰ç«¯å•å…ƒæµ‹è¯•
npm run test:server      # è¿è¡Œåç«¯å•å…ƒæµ‹è¯•
npm run test:e2e         # è¿è¡Œ E2E æµ‹è¯•
npm run coverage         # ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
```

#### ä»£ç è´¨é‡è„šæœ¬
```bash
npm run lint             # è¿è¡Œ ESLint æ£€æŸ¥
npm run lint:fix         # è‡ªåŠ¨ä¿®å¤ ESLint é—®é¢˜
npm run format           # æ ¼å¼åŒ–ä»£ç 
npm run format:check     # æ£€æŸ¥ä»£ç æ ¼å¼
```

---

## 10. æ•°æ®åº“è®¾è®¡

### 10.1 æ•°æ®è¡¨ç»“æ„

#### users è¡¨ï¼ˆç”¨æˆ·è¡¨ï¼‰
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼Œè‡ªå¢ |
| name | TEXT | ç”¨æˆ·åï¼Œå”¯ä¸€ |
| email | TEXT | é‚®ç®± |
| password | TEXT | å¯†ç ï¼ˆbcrypt åŠ å¯†ï¼‰ |
| role | TEXT | è§’è‰²ï¼ˆadmin/userï¼‰ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | æ›´æ–°æ—¶é—´ |

#### funds è¡¨ï¼ˆèµ„é‡‘è¡¨ï¼‰
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼Œè‡ªå¢ |
| user_id | INTEGER | ç”¨æˆ· IDï¼ˆå¤–é”®ï¼‰ |
| amount | REAL | é‡‘é¢ |
| timestamp | DATETIME | æ—¶é—´æˆ³ |

#### fund_logs è¡¨ï¼ˆèµ„é‡‘æ—¥å¿—è¡¨ï¼‰
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼Œè‡ªå¢ |
| user_id | INTEGER | ç”¨æˆ· IDï¼ˆå¤–é”®ï¼‰ |
| type | TEXT | ç±»å‹ï¼ˆinitial/add/withdrawï¼‰ |
| amount | REAL | é‡‘é¢ |
| balance_after | REAL | æ“ä½œåä½™é¢ |
| remark | TEXT | å¤‡æ³¨ |
| timestamp | DATETIME | æ—¶é—´æˆ³ |

#### positions è¡¨ï¼ˆæŒä»“è¡¨ï¼‰
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼Œè‡ªå¢ |
| user_id | INTEGER | ç”¨æˆ· IDï¼ˆå¤–é”®ï¼‰ |
| asset_type | TEXT | èµ„äº§ç±»å‹ï¼ˆstock/future/fundï¼‰ |
| code | TEXT | ä»£ç  |
| name | TEXT | åç§° |
| operation | TEXT | æ“ä½œï¼ˆbuy/sellï¼‰ |
| price | REAL | ä»·æ ¼ |
| quantity | INTEGER | æ•°é‡ |
| fee | REAL | æ‰‹ç»­è´¹ |
| timestamp | DATETIME | æ—¶é—´æˆ³ |

#### price_data è¡¨ï¼ˆä»·æ ¼æ•°æ®è¡¨ï¼‰
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| code | TEXT | ä»£ç ï¼ˆè”åˆä¸»é”®ï¼‰ |
| asset_type | TEXT | èµ„äº§ç±»å‹ï¼ˆè”åˆä¸»é”®ï¼‰ |
| current_price | REAL | å½“å‰ä»·æ ¼ |
| timestamp | DATETIME | æ›´æ–°æ—¶é—´ |

### 10.2 ç´¢å¼•è®¾è®¡

- **users è¡¨**: `idx_users_name`, `idx_users_email`, `idx_users_role`
- **funds è¡¨**: `idx_funds_user_id`, `idx_funds_timestamp`
- **fund_logs è¡¨**: `idx_fund_logs_user_id`, `idx_fund_logs_timestamp`, `idx_fund_logs_type`
- **positions è¡¨**: `idx_positions_user_id`, `idx_positions_code`, `idx_positions_asset_type`, `idx_positions_user_code`
- **price_data è¡¨**: `idx_price_data_code_type`, `idx_price_data_timestamp`

---

## 11. éƒ¨ç½²ç›¸å…³

### 11.1 Docker éƒ¨ç½²

#### æœåŠ¡ç»„æˆ
- **backend**: Express åç«¯æœåŠ¡ï¼ˆç«¯å£ 3001ï¼‰
- **frontend**: Nginx + React å‰ç«¯æœåŠ¡ï¼ˆç«¯å£ 80ï¼‰

#### æ•°æ®æŒä¹…åŒ–
- **backend-data**: å­˜å‚¨ SQLite æ•°æ®åº“
- **backend-logs**: å­˜å‚¨åº”ç”¨æ—¥å¿—

#### å¥åº·æ£€æŸ¥
- **backend**: HTTP å¥åº·æ£€æŸ¥ç«¯ç‚¹ `/health`
- **frontend**: Nginx æ ¹è·¯å¾„æ£€æŸ¥

### 11.2 éƒ¨ç½²å‘½ä»¤

```bash
# æ„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# æ•°æ®å¤‡ä»½
./docker-data-manager.sh backup

# æ•°æ®æ¢å¤
./docker-data-manager.sh restore backup-file.tar.gz
```

### 11.3 Nginx é…ç½®

- é™æ€èµ„æºæœåŠ¡ï¼ˆReact æ„å»ºäº§ç‰©ï¼‰
- API åå‘ä»£ç†åˆ°åç«¯æœåŠ¡
- Gzip å‹ç¼©
- ç¼“å­˜ç­–ç•¥

---

## 12. å¼€å‘æŒ‡å—

### 12.1 æœ¬åœ°å¼€å‘æµç¨‹

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone https://github.com/yushukk/trading-custody.git
   cd trading-custody
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   npm install
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   cp .env.example .env.development
   # ç¼–è¾‘ .env.development é…ç½®
   ```

4. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
   ```bash
   npm run dev
   ```

5. **è®¿é—®åº”ç”¨**
   - å‰ç«¯: http://localhost:3000
   - åç«¯: http://localhost:3001

### 12.2 ä»£ç æäº¤è§„èŒƒ

é¡¹ç›®ä½¿ç”¨ Husky + lint-staged è¿›è¡Œä»£ç è´¨é‡æ§åˆ¶ï¼š

- **pre-commit**: è‡ªåŠ¨è¿è¡Œ ESLint å’Œ Prettier
- **commit message**: å»ºè®®ä½¿ç”¨ Conventional Commits è§„èŒƒ

### 12.3 æµ‹è¯•è§„èŒƒ

- **å•å…ƒæµ‹è¯•**: è¦†ç›–æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- **é›†æˆæµ‹è¯•**: æµ‹è¯• API ç«¯ç‚¹
- **E2E æµ‹è¯•**: æµ‹è¯•å…³é”®ç”¨æˆ·æµç¨‹

---

## 13. å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•é‡ç½®ç®¡ç†å‘˜å¯†ç ï¼Ÿ
```bash
node server/migrations/reset_admin_password.js
```

### Q2: å¦‚ä½•ä¿®æ”¹ç«¯å£ï¼Ÿ
ç¼–è¾‘ `.env.development` æ–‡ä»¶ä¸­çš„ `PORT` å’Œ `SERVER_PORT`ã€‚

### Q3: å¦‚ä½•æ·»åŠ æ–°çš„ API ç«¯ç‚¹ï¼Ÿ
1. åœ¨ `server/controllers/` æ·»åŠ æ§åˆ¶å™¨æ–¹æ³•
2. åœ¨ `server/services/` æ·»åŠ ä¸šåŠ¡é€»è¾‘
3. åœ¨ `server/config/routes.js` æ³¨å†Œè·¯ç”±
4. åœ¨ `server/validators/` æ·»åŠ éªŒè¯è§„åˆ™ï¼ˆå¯é€‰ï¼‰

### Q4: å¦‚ä½•æ·»åŠ æ–°çš„å‰ç«¯é¡µé¢ï¼Ÿ
1. åœ¨ `src/components/` åˆ›å»ºç»„ä»¶
2. åœ¨ `src/routes/index.jsx` æ·»åŠ è·¯ç”±é…ç½®
3. åœ¨ `src/components/NavBar.jsx` æ·»åŠ å¯¼èˆªé“¾æ¥ï¼ˆå¯é€‰ï¼‰

---

## 14. å‚è€ƒèµ„æº

- **é¡¹ç›®ä»“åº“**: https://github.com/yushukk/trading-custody
- **React æ–‡æ¡£**: https://reactjs.org/
- **Express æ–‡æ¡£**: https://expressjs.com/
- **Ant Design Mobile**: https://mobile.ant.design/
- **SQLite æ–‡æ¡£**: https://www.sqlite.org/docs.html

---

## 15. è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](../LICENSE) æ–‡ä»¶ã€‚

---

**æ–‡æ¡£ç»´æŠ¤**: å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– Pull Requestã€‚

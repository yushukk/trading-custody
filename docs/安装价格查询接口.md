https://aktools.akfamily.xyz/aktools/#_2

一、环境准备（CentOS/Ubuntu 通用）

# 1. 创建专用系统用户（推荐）
sudo useradd --system --no-create-home --shell /bin/false akshare

# 2. 创建项目目录
sudo mkdir -p /opt/aktools-api /var/log/aktools
sudo chown -R akshare:akshare /opt/aktools-api /var/log/aktools

# 3. 进入项目目录
cd /opt/aktools-api

二、虚拟环境与 AKTools 安装
# 1. 创建 Python 虚拟环境
sudo -u akshare python3 -m venv venv

# 2. 激活环境并安装（使用国内镜像加速）[^42^][^40^]
source venv/bin/activate
pip install --upgrade pip
pip install aktools -i https://pypi.tuna.tsinghua.edu.cn/simple

# 3. 验证安装
python -c "import aktools; print('AKTools 安装成功')"

# 4. 测试运行（确认无报错后再配置 systemd）
python -m aktools --host 127.0.0.1 --port 8080
# 按 Ctrl+C 退出测试

三、创建 Systemd 服务文件
# 1.sudo nano /etc/systemd/system/aktools.service
```
[Unit]
Description=AKTools HTTP API Service
After=network.target

[Service]
# 使用专用用户运行
Type=simple
User=akshare
Group=akshare
WorkingDirectory=/opt/aktools-api

# 关键：直接调用 venv 中的 Python 解释器，无需 source activate
Environment=PATH=/opt/aktools-api/venv/bin
Environment=PYTHONPATH=/opt/aktools-api

# 启动命令（推荐绑定 0.0.0.0，允许外网访问）[^35^][^42^]
ExecStart=/opt/aktools-api/venv/bin/python -m aktools \
          --host 0.0.0.0 \
          --port 8080 \

# 自动重启策略（确保服务异常退出后自动恢复）
Restart=always
RestartSec=10
StartLimitBurst=5
StartLimitIntervalSec=60

# 日志配置（使用 systemd journal 统一管理）[^42^]
StandardOutput=journal
StandardError=journal
SyslogIdentifier=aktools

# 安全限制（推荐，但需注意路径权限）
NoNewPrivileges=yes
PrivateTmp=yes
ProtectSystem=strict
ProtectHome=yes
ReadWritePaths=/opt/aktools-api /var/log/aktools

[Install]
WantedBy=multi-user.target
```
四、服务管理命令
# 1. 重新加载 systemd 配置
sudo systemctl daemon-reload

# 2. 设置开机自启
sudo systemctl enable aktools

# 3. 启动服务
sudo systemctl start aktools

# 4. 查看服务状态
sudo systemctl status aktools
# 预期输出：active (running)

# 5. 查看实时日志
sudo journalctl -u aktools -f

# 6. 重启服务（配置更新后）
sudo systemctl restart aktools

# 7. 停止服务
sudo systemctl stop aktools



docker方式：
```
services:
  aktools:
    image: registry.cn-shanghai.aliyuncs.com/akfamily/aktools:1.15.73
    container_name: aktools
    restart: unless-stopped
    ports:
      - "18201:8080"          # 如端口冲突，可改为 8081:8080 等
    command: >
      sh -c "
        gunicorn aktools.main:application
        -b 0.0.0.0:8080
        -w 4
        -k uvicorn.workers.UvicornWorker
      "
    # environment:
      # 如需自定义 AKTools 启动参数，可在此追加，例如：
      # AKTOOLS_WORKERS: "4"
      # AKTOOLS_TIMEOUT: "120"
    # volumes:
      # 如需持久化 AKTools 产生的缓存或日志，可放开下面两行
      # - ./data:/app/data
      # - ./logs:/app/logs
    networks:
      - aktools-net

networks:
  aktools-net:
    driver: bridge
```
